apiVersion: platform.confluent.io/v1beta1
kind: KRaftController
metadata:
  name: "kraftcontroller"
  namespace: "confluent"
spec:
  dataVolumeCapacity: "10G"
  image:
    application: "docker.io/confluentinc/cp-server:7.7.0"
    init: "confluentinc/confluent-init-container:2.9.0"
  listeners:
    controller:
      tls:
        enabled: true
      authentication:
        type: "plain"
        jaasConfig:
          secretRef: "credential"
  tls:
    autoGeneratedCerts: true
  replicas: 1
---
apiVersion: platform.confluent.io/v1beta1
kind: Kafka
metadata:
  name: "kafka"
  namespace: "confluent"
spec:
  dataVolumeCapacity: "10G"
  image:
    application: "docker.io/confluentinc/cp-server:7.7.0"
    init: "confluentinc/confluent-init-container:2.9.0"
  tls:
    autoGeneratedCerts: true
  replicas: 1
  listeners:
    internal:
      authentication:
        type: "oauth"
        jaasConfigPassThrough:
          secretRef: "pass-through-internal"
        oauthSettings:
          audience: "a03f7eb3-6a16-4a55-925e-29541ea64065"
          expectedIssuer: "https://login.microsoftonline.com/072a2d88-d71f-447d-96e0-09e0a9ca56c3/v2.0"
          jwksEndpointUri: "https://login.microsoftonline.com/072a2d88-d71f-447d-96e0-09e0a9ca56c3/discovery/v2.0/keys"
          tokenEndpointUri: "https://login.microsoftonline.com/072a2d88-d71f-447d-96e0-09e0a9ca56c3/oauth2/v2.0/token"
          scope: "https://graph.microsoft.com/.default"  # Updated scope
      tls:
        enabled: true
    replication:
      authentication:
        type: "oauth"
        jaasConfigPassThrough:
          secretRef: "pass-through-repl"
        oauthSettings:
          audience: "a03f7eb3-6a16-4a55-925e-29541ea64065"
          expectedIssuer: "https://login.microsoftonline.com/072a2d88-d71f-447d-96e0-09e0a9ca56c3/v2.0"
          jwksEndpointUri: "https://login.microsoftonline.com/072a2d88-d71f-447d-96e0-09e0a9ca56c3/discovery/v2.0/keys"
          tokenEndpointUri: "https://login.microsoftonline.com/072a2d88-d71f-447d-96e0-09e0a9ca56c3/oauth2/v2.0/token"
          scope: "https://graph.microsoft.com/.default"  # Updated scope
      tls:
        enabled: true
  dependencies:
    kRaftController:
      controllerListener:
        tls:
          enabled: true
        authentication:
          type: "plain"
          jaasConfig:
            secretRef: "credential"
      clusterRef:
        name: "kraftcontroller"
